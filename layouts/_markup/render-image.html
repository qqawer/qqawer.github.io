{{- $image := partial "helper/image" (dict "Resources" .Page.Resources "Image" .Destination) -}}
{{- $alt := .PlainText | safeHTML -}}
{{- $isString := eq (printf "%T" $image) "string" -}}

{{/* SVG and external images won't work with gallery layout, because their width and height attributes are unknown */}}
{{- $galleryImage := false -}}
{{- if not $isString -}}
{{- $galleryImage = and $image.Height $image.Width -}}
{{- end -}}

<img src="{{ if $isString }}{{ $image }}{{ else }}{{ $image.Permalink }}{{ end }}" {{ if not $isString }} {{ with
    $image.Width }}width="{{ . }}" {{ end }} {{ with $image.Height }}height="{{ . }}" {{ end }} {{ end }} loading="lazy"
    {{ with $alt }} alt="{{ . }}" {{ end }} {{ if $galleryImage }} class="gallery-image"
    data-flex-grow="{{ div (mul $image.Width 100) $image.Height }}"
    data-flex-basis="{{ div (mul $image.Width 240) $image.Height }}px" {{ end }}>